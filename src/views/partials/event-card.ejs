<div class="col-md-6 col-lg-4">
  <div class="card h-100 border-0 shadow-sm event-card">

    <% if (ev.imageUrl) { %>
      <div class="ratio ratio-16x9 overflow-hidden rounded-top">
        <a href="/events/<%= ev._id %>">
          <img src="<%= ev.imageUrl %>" class="w-100 h-100 object-fit-cover" alt="<%= ev.title %>" />
        </a>
      </div>
    <% } else { %>
      <div class="bg-secondary-subtle text-secondary text-center py-5 rounded-top">
        <i class="bi bi-image-alt fs-1"></i><br />ไม่มีรูปภาพ
      </div>
    <% } %>

    <div class="card-body">
      <h5 class="card-title mb-1">
        <a href="/events/<%= ev._id %>" class="text-decoration-none card-link fw-semibold">
          <%= ev.title %>
        </a>
      </h5>

      <p class="medium text-primary-color mb-2">
        <i class="bi bi-calendar-event"></i>
        <% if (ev.startDate && ev.endDate) { 
            const now = new Date();
            const endDate = new Date(ev.endDate);
            if (endDate < now) { %>
              <span class="text-danger fw-semibold"> Event has ended </span>
            <% } else if (ev.lockStart) { %>
              Now – <%= new Date(ev.endDate).toLocaleDateString('en-GB', { day:'numeric', month:'short', year:'numeric' }) %> 
              at <%= new Date(ev.endDate).toLocaleTimeString('en-GB', { hour:'2-digit', minute:'2-digit', hour12:false }) %>
            <% } else { 
                if (new Date(ev.startDate).toDateString() === new Date(ev.endDate).toDateString()) { %>
                  <%= new Date(ev.startDate).toLocaleDateString('en-GB', { day:'numeric', month:'short', year:'numeric' }) %> 
                  at <%= new Date(ev.startDate).toLocaleTimeString('en-GB', { hour:'2-digit', minute:'2-digit', hour12:false }) %> – 
                  <%= new Date(ev.endDate).toLocaleTimeString('en-GB', { hour:'2-digit', minute:'2-digit', hour12:false }) %>
                <% } else { %>
                  <%= new Date(ev.startDate).toLocaleDateString('en-GB', { day:'numeric', month:'short', year:'numeric' }) %> 
                  at <%= new Date(ev.startDate).toLocaleTimeString('en-GB', { hour:'2-digit', minute:'2-digit', hour12:false }) %> – 
                  <%= new Date(ev.endDate).toLocaleDateString('en-GB', { day:'numeric', month:'short', year:'numeric' }) %> 
                  at <%= new Date(ev.endDate).toLocaleTimeString('en-GB', { hour:'2-digit', minute:'2-digit', hour12:false }) %>
                <% } 
            } 
        } else if (ev.date) { %>
          <%= new Date(ev.date).toLocaleDateString('en-GB', { day:'numeric', month:'short', year:'numeric' }) %> 
          at <%= new Date(ev.date).toLocaleTimeString('en-GB', { hour:'2-digit', minute:'2-digit', hour12:false }) %>
        <% } else { %>
          — 
        <% } %>
        <br />
        <i class="bi bi-geo-alt me-1"></i><%= ev.location || '—' %>
      </p>

      <hr />
      <p class="small mb-0">
        <%- (ev.description || '<i>No details...</i>').slice(0, 120) %>
      </p>
    </div>

    <div class="card-footer border-top-0 d-flex justify-content-between align-items-center">
      <span class="fw-bold text-success">฿<%= Number(ev.price||0).toLocaleString() %></span>
      <a href="/events/<%= ev._id %>" class="btn btn-outline-success btn-sm">รายละเอียด</a>
    </div>

  </div>
</div>
