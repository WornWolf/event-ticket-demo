<div class="col-md-6 col-lg-4">
  <div class="card h-100 border-0 shadow-sm event-card">

    <% if (ev.imageUrl) { %>
      <div class="ratio ratio-16x9 overflow-hidden rounded-top">
        <a href="/events/<%= ev._id %>">
          <img src="<%= ev.imageUrl %>" class="w-100 h-100 object-fit-cover" alt="<%= ev.title %>" />
        </a>
      </div>
    <% } else { %>
      <div class="bg-secondary-subtle text-secondary text-center py-5 rounded-top">
        <i class="bi bi-image-alt fs-1"></i><br />ไม่มีรูปภาพ
      </div>
    <% } %>

    <div class="card-body">
      <h5 class="card-title mb-1">
        <a href="/events/<%= ev._id %>" class="text-decoration-none card-link fw-semibold">
          <%= ev.title %>
        </a>
      </h5>

      <p class="medium text-primary-color mb-2">
        <i class="bi bi-calendar-event"></i>
        <% if (ev.startDate && ev.endDate) { 
            const now = dayjs().tz('Asia/Bangkok');
            const endDate = dayjs(ev.endDate).tz('Asia/Bangkok');
            if (endDate.isBefore(now)) { %>
              <span class="text-danger fw-semibold"> Event has ended </span>
            <% } else if (ev.lockStart) { %>
              Now – <%= endDate.format('D MMM YYYY [at] HH:mm') %>
            <% } else { 
                const startDate = dayjs(ev.startDate).tz('Asia/Bangkok');
                if (startDate.isSame(endDate, 'day')) { %>
                  <%= startDate.format('D MMM YYYY [at] HH:mm') %> – <%= endDate.format('HH:mm') %>
                <% } else { %>
                  <%= startDate.format('D MMM YYYY [at] HH:mm') %> – <%= endDate.format('D MMM YYYY [at] HH:mm') %>
                <% } 
            } 
        } else if (ev.date) { 
            const d = dayjs(ev.date).tz('Asia/Bangkok'); %>
          <%= d.format('D MMM YYYY [at] HH:mm') %>
        <% } else { %>
          — 
        <% } %>
        <br />
        <i class="bi bi-geo-alt me-1"></i><%= ev.location || '—' %>
      </p>

      <hr />
      <p class="small mb-0">
        <%- (ev.description || '<i>No details...</i>').slice(0, 120) %>
      </p>
    </div>

    <div class="card-footer border-top-0 d-flex justify-content-between align-items-center">
      <span class="fw-bold text-success">฿<%= Number(ev.price||0).toLocaleString() %></span>
      <a href="/events/<%= ev._id %>" class="btn btn-outline-success btn-sm">รายละเอียด</a>
    </div>

  </div>
</div>
